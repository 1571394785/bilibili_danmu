<!DOCTYPE html>
<html>

<head>
    <!-- 禁用手机缩放 -->
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <title>bilibili弹幕姬</title>
    <!--您好，感谢您浏览这一串大便一样的代码
                  ╭━━━━╮
          ╭╮╭━━━━━┫┃▋▋━▅
          ┃╰┫     ┃┃    ╰-┫
          ╰━┫     ╰╯╰┳━━━━╯
          / ┃┏┳┳━━┓┏┳┫
shitty code ┗┛┗┛  ┗┛┗┛
-->
    <script src="https://apps.bdimg.com/libs/jquery/2.1.4/jquery.min.js" type="text/javascript"></script>
    <!-- jquery.danmu.js (//github.com/chiruom/danmu/) - Licensed under the MIT license -->
    <script src="js\jquery.danmu.min.js" type="text/javascript"></script>
    <link rel="shortcut icon" href="favicon.ico" type="image/x-icon">
    <style>
        body {
            background-color: #fb7299;
            color: #ffffff;
            font-family: "inherit";
            margin: 0;
            user-select: none;
            /* 隐藏滚动条 */
            overflow-x: hidden;
        }

        .h1 div {
            width: 600px;
            height: 314px;
            margin: 0 auto 10px auto;
            background-size: contain;
            border-color: #ffffff;
            border-style: none solid;

        }

        .js {
            font-size: 7vmin;
            font-weight: bold;
            text-shadow: 0 0 5px #ffffff;
            text-align: center;
            transition: 0.5s;
        }

        .js:hover {
            color: rgba(255, 255, 255, 0.5);
            -webkit-text-stroke: 1px rgb(0, 0, 0);
        }

        .js2 {
            font-size: 3vmin;
            font-weight: bold;
            text-shadow: 0 0 4px #ffffff;
            text-align: center;
            transition: 0.5s;
        }

        .js2:hover {
            color: rgba(255, 255, 255, 0.5);
            -webkit-text-stroke: 0.7px rgb(0, 0, 0);
        }

        #danmu {
            margin: 0;
            padding: 0;
        }

        #head {
            width: max-content;
            height: auto;
            background-color: rgba(0, 0, 0, 0.2);
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.7);
            padding: 20px;
            position: absolute;
            top: 7%;
            left: 0%;
            right: 0%;
            margin: auto;
            z-index: -1;
            /* 圆角 */
            border-radius: 20px;
            transition: all 0.2s;
            perspective: 500px;
            cursor: pointer;
        }

        #dld {
            width: 100px;
            height: 50px;
            background-color: #00AEEC;
            color: #ffffff;
            border: 0;
            border-radius: 10px;
            margin: 0;
            cursor: pointer;
            font-size: 20px;
            font-weight: bold;
            bottom: 13%;
            position: absolute;
            left: 50%;
            transform: translateX(-50%);
            transition: 0.25s;
        }

        #dld:hover {
            background-color: #00AEEC;
            color: #ffffff;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.7);
        }

        @media screen and (max-width: 600px) {
            h1 {
                font-size: 20vmin;
            }

            .js {
                font-size: 15vmin;
            }
        }

        #bodys {
            position: absolute;
            top: 100%;
            height: 100%;
            width: 100%;
            transition: 0.3s;
        }

        #xiajian {
            width: 30px;
            height: 30px;
            position: absolute;
            bottom: 4%;
            left: 50%;
            transform: translateX(-50%) rotate(135deg);
            z-index: -1;
            border-style: solid solid none none;
        }

        #xiajian2 {
            width: 30px;
            height: 30px;
            position: absolute;
            bottom: 4.5%;
            left: 50%;
            transform: translateX(-50%) rotate(135deg);
            z-index: -1;
            border-style: solid solid none none;
            filter: blur(2px);
            /* 穿透 */
            pointer-events: none;
        }

        #shuoming {
            color: black;
            position: relative;
            width: max-content;
            left: 0;
            right: 0;
            top: 10%;
            margin-left: auto;
            margin-right: auto;
            /* 增大行间距 */
            line-height: 3;
            font-family: "inherit";
            font-size: 20px;
        }
        #xuexi{
            font-size: 15px;
            color: #000000;
            position: absolute;
            bottom: 1%;
            left: 50%;
            transform: translateX(-50%);
        }
    </style>
</head>

<body>
    <div id="head">
        <div class="h1">
            <div style="background-image: url('弹幕姬logo.png')"></div>
        </div>
        <div class="js">该插件可以把弹幕塞进任何网页观看</div>
        <div class="js2">（该api使用了弹弹play）</div>
    </div>
    <div id="danmu"></div>
    <div id="xiajian"></div>
    <div id="xiajian2"></div>
    <div id="bodys">
        <div id="xuexi">该插件仅供学习交流使用，禁止商用</div>
        <div id="shuoming">
            <p style="text-align: center;">使用方法</p>
            <p> 1.点击上方下载按钮，下载弹幕姬插件（目前需要科技上网才能下载）<br>
                2.解压到任意文件夹，在浏览器扩展页面打开开发者模式，点击加载已解压的扩展程序，选择刚才的文件夹<br>
                3.打开任意番剧资源网站，如樱花动漫，风车动漫等<br>
                4.点击弹幕姬插件图标，选择搜索弹幕，并选择相应的番剧与集数，等待加载完成，点击确定<br>
                5.打开番剧页面，选择弹幕姬的自动嵌入<br>
                6.若自动嵌入不成功，则选择手动嵌入，手动选择元素定位弹幕位置（该功能开发中，目前不支持全屏）<br>
            </p>
        </div>
    </div>
    <!-- 按钮 -->
    <button id="dld" onclick="window.open('https://github.com/1571394785/bilibili_danmu/releases/download/latest/crx.zip')">下载</button>
    <script>
        //计算鼠标在#head上的位置
        $('#head').mousemove(function (e) {
            var x = e.pageX - $(this).offset().left;
            var y = e.pageY - $(this).offset().top;
            var w = $(this).width();
            var h = $(this).height();
            var x1 = x / w;
            var y1 = y / h;
            var x2 = x1 - 0.5;
            var y2 = y1 - 0.5;
            var x3 = x2 * 10;
            var y3 = y2 * 10;
            $(this).css('transform', 'perspective(500px) rotateX(' + -y3 + 'deg) rotateY(' + x3 + 'deg)');
        });
        //鼠标离开#head重置
        $('#head').mouseleave(function () {
            $(this).css('transform', 'perspective(700px) rotateX(0deg) rotateY(0deg)');
        });
        // 生成弹幕div
        function createdanmu() {
            danmu = window.danmu
            color = ["#FE0302", "#FF7204", "#FFAA02", "#FFD302", "#FFFF00", "#A0EE00", "#00CD00", "#019899", "#4266BE", "#89D5FF", "#CC0273", "#222222", "#9B9B9B", "#FFFFFF"];
            random_danmu = danmu[Math.floor(Math.random() * danmu.length)];
            random_color = color[Math.floor(Math.random() * color.length)];
            //random_position大部分0，少部分1，2
            random_position = Math.floor(Math.random() * 3);
            random_position = String(random_position);
            json1 = {
                "text": random_danmu,
                "color": random_color,
                "size": "1",
                "position": "0",
                "time": $('#danmu').data("nowTime") + 1
            };
            return json1;
        }
        function add() {
            var dm = createdanmu()
            $("#danmu").danmu("addDanmu", dm)
        }
        //get弹幕
        function getdanmu() {
            $.ajax({
                type: "GET",
                url: "danmu.txt",
                dataType: "text",
                success: function (data) {
                    danmu = data.split("\n");
                    console.log(danmu);
                }
            });
        }
        // 监听窗口大小
        $(window).resize(function () {
            danmuDom = document.getElementById("danmu");
            danmuDom.style.height = window.innerHeight - 1 + "px";
            danmuDom.style.width = window.innerWidth - 1 + "px";
        });
        //运行
        $("#danmu").danmu({
            height: window.innerHeight - 1,   //弹幕区域高度
            width: window.innerWidth - 5,   //弹幕区域宽度
            zindex: -2,   //弹幕区域z-index属性
            speed: 9000,      //滚动弹幕的默认速度，这是数值是弹幕滚过每672像素所需要的时间（毫秒）
            sumTime: 65565,   //弹幕流的总时间
            danmuLoop: false,   //是否循环播放弹幕
            defaultFontColor: "#FFFFFF",   //弹幕的默认颜色
            fontSizeSmall: 16,     //小弹幕的字号大小
            FontSizeBig: 24,       //大弹幕的字号大小
            opacity: "0.6",			//默认弹幕透明度
            topBottonDanmuTime: 6000,   // 顶部底部弹幕持续时间（毫秒）
            SubtitleProtection: false,     //是否字幕保护
            positionOptimize: false,         //是否位置优化，位置优化是指像AB站那样弹幕主要漂浮于区域上半部分
            maxCountInScreen: 1000,   //屏幕上的最大的显示弹幕数目,弹幕数量过多时,优先加载最新的。
            maxCountPerSec: 1000      //每分秒钟最多的弹幕数目,弹幕数量过多时,优先加载最新的。
        });
        getdanmu();
        $("#danmu").danmu("danmuStart");
        setInterval(add, 101);
        // 点击xiajian往下滚
        $("#xiajian").click(function () {
            document.documentElement.scrollTo({ top: 1080, behavior: 'smooth' })
        });
        window.onscroll = function () {
            var t = document.documentElement.scrollTop || document.body.scrollTop;
            document.getElementById("bodys").style.backgroundColor = "rgba(255,255,255," + t / 700 + ")";
        }
    </script>
</body>

</html>